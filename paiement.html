<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Paiement - Vision Électronique</title>
<style>
/* ===== Body ===== */
/* ===== Body centré verticalement ===== */
/* ===== Body centré verticalement ===== */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f0f4f8;
  margin: 0;
  padding: 0;
  height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  overflow: hidden; /* Empêche le scroll */
}

/* ===== Bannière très grande avec animation texte ===== */
.header-banner {
  width: 95%;
  height: 35vh; /* plus grande pour image */
  background: linear-gradient(135deg, #007bff, #28a745);
  display: flex;
  justify-content: center;
  align-items: center;
  color: white;
  font-size: 3rem;
  font-weight: bold;
  text-shadow: 2px 2px 10px rgba(0,0,0,0.4);
  margin-bottom: 20px;
  border-radius: 12px;
  position: relative;
  overflow: hidden;
}

/* Animation du texte au milieu */
.header-banner::after {
  content: '';
  position: absolute;
  width: 100%;
  height: 100%;
  background: url('https://via.placeholder.com/1200x400') center/cover no-repeat; /* image de fond */
  top: 0;
  left: 0;
  opacity: 0.3; /* transparence pour voir le texte */
  z-index: 0;
}

.header-banner span {
  position: relative;
  z-index: 1;
  animation: textePulse 3s ease-in-out infinite alternate;
}

@keyframes textePulse {
  0% { transform: scale(1); opacity: 0.8; }
  50% { transform: scale(1.05); opacity: 1; }
  100% { transform: scale(1); opacity: 0.8; }
}


/* ===== Container central compact ===== */
.payment-container {
  background: #ffffff;
  padding: 15px 20px;
  border-radius: 15px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
  max-width: 520px;
  width: 90%;
  display: flex;
  flex-direction: column;
  gap: 10px;
  max-height: 75vh;
  overflow-y: auto; /* permet de scroller juste si vraiment nécessaire */
}

/* ===== Titres ===== */
h2 {
  color: #007bff;
  text-align: center;
  font-size: 1.8rem;
  margin: 5px 0;
}

/* ===== Ligne mode de paiement et numéro ===== */
.ligne-paiement {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.ligne-paiement select,
.ligne-paiement input {
  flex: 1;
  padding: 10px;
  border-radius: 8px;
  border: 2px solid #ccc;
  font-size: 0.95rem;
  transition: all 0.3s ease;
}

.ligne-paiement select:focus,
.ligne-paiement input:focus {
  border-color: #007bff;
  box-shadow: 0 0 6px rgba(0,123,255,0.3);
  outline: none;
}

/* ===== Boutons ===== */
.boutons-ligne {
  display: flex;
  justify-content: space-between;
  gap: 10px;
  flex-wrap: wrap;
}

.btn {
  flex: 1;
  padding: 12px;
  border: none;
  border-radius: 10px;
  font-size: 1rem;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 5px 12px rgba(0,0,0,0.1);
}

.btn-primary {
  background: linear-gradient(45deg, #28a745, #20c997);
  color: white;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(40,167,69,0.4);
}

.btn-secondary {
  background: linear-gradient(45deg, #ffc107, #fd7e14);
  color: white;
}

.btn-secondary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(255,193,7,0.4);
}

/* ===== Message de courtoisie ===== */
#courtoisieMessage {
  text-align: center;
  font-weight: bold;
  font-size: 1rem;
  color: #28a745;
  animation: fadeIn 1s ease forwards;
  display: none;
  margin-top: 5px;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-5px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ===== Erreur numéro ===== */
.error-message {
  color: red;
  font-size: 0.85rem;
  margin: 0;
}

/* ===== Responsive ===== */
@media (max-width: 500px) {
  .ligne-paiement,
  .boutons-ligne {
    flex-direction: column;
  }
}

</style>
</head>
<body>

<div class="header-banner">Vision Électronique</div>

<div class="payment-container">

  <label>
    <input type="checkbox" id="livraison">
    Je souhaite être livré (frais supplémentaires 1500 FCFA)
  </label>
  <p id="temps-livraison"></p>

  <h2>Paiement sécurisé</h2>

  <ul id="cart-items"></ul>
  <p>Total : <span id="cart-total">0 FCFA</span></p>

  <div class="ligne-paiement">
    <select id="mode-paiement">
      <option value="">-- Sélectionnez --</option>
      <option value="orange">Orange Money</option>
      <option value="wave">Wave</option>
      <option value="moov">Moov Money</option>
      <option value="whatsapp">Commande via WhatsApp</option>
    </select>

    <input type="text" id="numero-paiement" placeholder="Ex: 79XXXXXX" maxlength="8">
  </div>
  <span id="error-numero" class="error-message"></span>

  <div class="boutons-ligne">
    <button class="btn btn-primary" onclick="payer()">Payer maintenant</button>
    <a href="index.html"><button class="btn btn-secondary">Retour à la boutique</button></a>
  </div>

  <p id="courtoisieMessage"></p>

</div>

<script>
const modePaiement = document.getElementById("mode-paiement");
const numeroInput = document.getElementById("numero-paiement");
const errorNumero = document.getElementById("error-numero");
const livraisonCheckbox = document.getElementById("livraison");
const tempsLivraison = document.getElementById("temps-livraison");

// Récupération du panier depuis localStorage
let panier = JSON.parse(localStorage.getItem("cart")) || [];

// Règles de validation
const reglesNumeros = {
  orange: /^[79]\d{7}$/,
  moov: /^[68]\d{7}$/,
  wave: /^[5-9]\d{7}$/,
  whatsapp: /^\d{8}$/
};

// Numéros par défaut
const numerosParDefaut = {
  orange: "79000000",
  wave: "50000000",
  moov: "60000000",
};

// Mettre le numéro par défaut selon le mode choisi
modePaiement.addEventListener("change", () => {
  const mode = modePaiement.value;
  numeroInput.value = numerosParDefaut[mode] || "";
  errorNumero.textContent = "";
});

// Validation numéro
function validerNumero(mode, numero) {
  const regex = reglesNumeros[mode];
  return regex ? regex.test(numero) : true;
}

// Mettre à jour l'affichage du panier et du total
function updateCartDisplay() {
  const cartItems = document.getElementById("cart-items");
  const cartTotal = document.getElementById("cart-total");
  cartItems.innerHTML = "";

  let total = 0;
  panier.forEach(item => {
    const li = document.createElement("li");
    li.textContent = `${item.quantity > 1 ? 'x' + item.quantity + ' ' : ''}${item.name} = ${item.price * item.quantity} FCFA`;
    cartItems.appendChild(li);
    total += item.price * item.quantity;
  });

  let fraisLivraison = (livraisonCheckbox.checked && panier.length > 0) ? 1500 : 0;
  cartTotal.textContent = (total + fraisLivraison) + " FCFA";
}

// Simulation de paiement
function simulationPaiement(mode, numero, montant, callback) {
  alert(`Paiement en cours via ${mode}...`);
  setTimeout(() => {
    const reussi = Math.random() > 0.1;
    callback(reussi);
  }, 2000);
}

// Fonction principale de paiement
function payer() {
  const mode = modePaiement.value;
  const numero = numeroInput.value.trim();
  const livraison = livraisonCheckbox.checked;
  errorNumero.textContent = "";

  if (!mode) { alert("Veuillez sélectionner un mode de paiement"); return; }

  if (panier.length === 0) {
    alert("Votre panier est vide !");
    return;
  }

  let total = panier.reduce((sum, item) => sum + item.price * item.quantity, 0);
  if (livraison) total += 1500;

if (mode === "whatsapp") {
    // Construire le message avec le panier
    let message = "Bonjour, je souhaite passer commande :\n\n";
    panier.forEach(item => {
        message += `- ${item.name} x${item.quantity} = ${item.price * item.quantity} FCFA\n`;
    });

    // Calcul du total
    let total = panier.reduce((sum, item) => sum + item.price * item.quantity, 0);
    if (livraisonCheckbox.checked) total += 1500; // frais livraison
    message += `\nTotal : ${total} FCFA`;

    // Ajouter estimation de livraison si nécessaire
    if (livraisonCheckbox.checked) {
        message += "\nEstimation livraison : 30 minutes";
    }

    // Numéro du service client au format international sans + ni espaces
    let numeroWA = "22352276697"; // remplace par ton numéro

    // Générer le lien WhatsApp avec encodage correct
    let url = `https://wa.me/${numeroWA}?text=${encodeURIComponent(message)}`;

    // Ouvrir WhatsApp dans un nouvel onglet ou app
    window.open(url, "_blank");

    // Vider le panier
    panier = [];
    localStorage.setItem("cart", JSON.stringify(panier));
    updateCartDisplay();

    // Afficher message de courtoisie
    const msg = document.getElementById("courtoisieMessage");
    msg.textContent = `Commande WhatsApp prête à être envoyée ! Total : ${total} FCFA.`;
    msg.style.display = "block";

    return; // Terminer la fonction ici
}



  if (!numero) { errorNumero.textContent = "Veuillez saisir un numéro de paiement"; return; }
  if (!validerNumero(mode, numero)) {
    errorNumero.textContent = "Numéro invalide pour " + mode;
    return;
  }

  let estimation = "";
  if (livraison && navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(pos => {
      const tempsApprox = Math.floor(Math.random() * 30) + 10;
      estimation = `Estimation livraison : ${tempsApprox} minutes.`;
      terminerPaiement(total, mode, estimation);
    }, err => {
      estimation = "Estimation livraison : 30 minutes.";
      terminerPaiement(total, mode, estimation);
    });
  } else if (livraison) {
    estimation = "Estimation livraison : 30 minutes.";
    terminerPaiement(total, mode, estimation);
  } else {
    terminerPaiement(total, mode, "");
  }
}

function terminerPaiement(total, mode, estimation) {
  simulationPaiement(mode, numeroInput.value, total, (reussi) => {
    if (reussi) {
      panier = [];
      localStorage.setItem("cart", JSON.stringify(panier));
      updateCartDisplay();

      const msg = document.getElementById("courtoisieMessage");
      msg.textContent = `Paiement de ${total} FCFA via ${mode} réussi ! ${estimation}`;
      msg.style.display = "block";
    } else {
      alert("Le paiement a échoué. Veuillez réessayer.");
    }
  });
}

updateCartDisplay();
livraisonCheckbox.addEventListener("change", updateCartDisplay);
</script>
</body>
</html>
